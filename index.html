function openShareModal(meetingId) {
    // âœ… Reset any previous state first
    currentSharingMeetingId = null;
    
    // âœ… Make sure modal is fully closed before reopening
    const modal = document.getElementById('shareModal');
    modal.classList.remove('active');
    
    // âœ… Small delay to ensure clean state
    setTimeout(() => {
        currentSharingMeetingId = meetingId;
        const meeting = state.meetings.find(m => m.id === meetingId);
        
        if (!meeting) {
            console.error('Meeting not found:', meetingId);
            showToast('âš ï¸ Meeting not found', 'error');
            return;
        }
        
        document.getElementById('shareModalTitle').textContent = `ðŸ”— Share "${meeting.title}"`;
        document.getElementById('shareModalMeetingId').value = meetingId;
        document.getElementById('shareEmailInput').value = '';
        document.getElementById('shareMessageInput').value = '';
        document.getElementById('shareNotifyEmail').checked = true;
        
        // Reset tab checkboxes to default (info and notes)
        document.querySelectorAll('input[name="shareTab"]').forEach(cb => {
            cb.checked = (cb.value === 'info' || cb.value === 'notes');
        });
        
        // Switch to first tab
        document.querySelectorAll('.share-modal-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.share-tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector('.share-modal-tab[data-share-tab="new"]').classList.add('active');
        document.querySelector('.share-tab-content[data-share-tab-content="new"]').classList.add('active');
        
        // Render shared with list
        renderSharedWithList(meetingId);
        
        // Setup link sharing
        setupLinkSharing(meetingId);
        
        // âœ… Force modal to be visible
        modal.style.display = 'flex';
        modal.classList.add('active');
        
        console.log('Share modal opened for meeting:', meetingId); // Debug log
    }, 50);
}
